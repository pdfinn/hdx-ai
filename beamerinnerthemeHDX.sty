% beamerinnerthemeHDX.sty
% Inner theme for Happy Digital X (HDX) Beamer presentations
%
% Handles: title page, section pages, blocks, items

\mode<presentation>

\RequirePackage{tikz}
\RequirePackage{graphicx}
\RequirePackage{calc}

\usetikzlibrary{positioning, shapes.geometric, calc, backgrounds}

% Path to assets (relative to main .tex file)
\newcommand{\hdxassetpath}{assets/}

%% ============================================================================
%% TITLE PAGE
%% ============================================================================

\defbeamertemplate*{title page}{HDX}{%
    \begin{tikzpicture}[remember picture, overlay]
        % HDX Logo top-left
        \node[anchor=north west] at ([xshift=8mm, yshift=-6mm]current page.north west) {%
            \includegraphics[height=12mm]{\hdxassetpath hdx-logo-full.png}%
        };
        % Tsinghua logos top-right
        \node[anchor=north east] at ([xshift=-8mm, yshift=-6mm]current page.north east) {%
            \includegraphics[height=10mm]{\hdxassetpath tsinghua-logos.png}%
        };
        % Dots pattern top-right corner (decorative)
        \node[anchor=north east, opacity=0.3] at ([xshift=5mm, yshift=5mm]current page.north east) {%
            \includegraphics[width=25mm]{\hdxassetpath dots-pattern.png}%
        };
    \end{tikzpicture}

    \vspace{20mm}
    \begin{center}
        % Title
        {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}
        \vspace{5mm}
        % Subtitle (Author name)
        {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}
        \vspace{2mm}
        % Institute
        {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}
    \end{center}
}

%% ============================================================================
%% SECTION PAGE
%% ============================================================================

\defbeamertemplate*{section page}{HDX}{%
    \begin{tikzpicture}[remember picture, overlay]
        % Purple rounded box in center
        \node[
            fill=hdxpurple,
            rounded corners=8pt,
            minimum width=0.7\paperwidth,
            minimum height=25mm,
            text=white,
            font=\Huge\bfseries,
            align=center
        ] at (current page.center) {%
            \insertsectionhead%
        };
        % HDX Logo centered above
        \node[anchor=south] at ([yshift=20mm]current page.center) {%
            \includegraphics[height=15mm]{\hdxassetpath hdx-logo-full.png}%
        };
    \end{tikzpicture}
}

% Automatically insert section page at each \section
\AtBeginSection[]{%
    \begin{frame}[plain, noframenumbering]
        \sectionpage
    \end{frame}
}

%% ============================================================================
%% ITEMS (Bullets and Enumerate)
%% ============================================================================

% Bullet points - small purple circles
\setbeamertemplate{itemize item}{%
    \tikz[baseline=-0.5ex]\fill[hdxpurple] (0,0) circle (0.25em);%
}
\setbeamertemplate{itemize subitem}{%
    \tikz[baseline=-0.5ex]\fill[hdxpurple] (0,0) circle (0.2em);%
}
\setbeamertemplate{itemize subsubitem}{%
    \tikz[baseline=-0.5ex]\fill[hdxpurple] (0,0) circle (0.15em);%
}

% Enumeration - purple squares with white numbers
\setbeamertemplate{enumerate item}{%
    \tikz[baseline=-0.5ex]{%
        \node[
            fill=hdxpurple,
            text=white,
            font=\bfseries\small,
            minimum size=1.5em,
            inner sep=0pt
        ] {\insertenumlabel};%
    }%
}
\setbeamertemplate{enumerate subitem}{%
    \tikz[baseline=-0.5ex]{%
        \node[
            fill=hdxpurple,
            text=white,
            font=\bfseries\scriptsize,
            minimum size=1.2em,
            inner sep=0pt
        ] {\insertenumlabel};%
    }%
}

%% ============================================================================
%% BLOCKS
%% ============================================================================

% Standard block with purple header
\setbeamertemplate{block begin}{%
    \par\vskip\medskipamount%
    \begin{beamercolorbox}[
        colsep*=.75ex,
        rounded=true,
        shadow=false
    ]{block title}%
        \usebeamerfont{block title}\insertblocktitle%
    \end{beamercolorbox}%
    {\parskip0pt\par}%
    \ifbeamercolorempty[bg]{block title}{}{\nointerlineskip\vskip-0.5pt}%
    \usebeamerfont{block body}%
    \begin{beamercolorbox}[
        colsep*=.75ex,
        vmode
    ]{block body}%
        \ifbeamercolorempty[bg]{block body}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
}
\setbeamertemplate{block end}{%
    \end{beamercolorbox}\vskip\smallskipamount%
}

%% ============================================================================
%% CUSTOM ENVIRONMENTS
%% ============================================================================

% Purple content box (full width, for emphasis slides)
\newenvironment{hdxpurplebox}{%
    \begin{tikzpicture}[remember picture, overlay]
        \fill[hdxpurple]
            ([xshift=-5mm]current page.west |- current page.center)
            rectangle
            ([xshift=5mm, yshift=-30mm]current page.east |- current page.center);
    \end{tikzpicture}
    \begin{center}
    \color{white}
}{%
    \end{center}
}

% Numbered topic item (for table of contents style)
\newcommand{\hdxtopicitem}[3]{%
    % #1 = number, #2 = title, #3 = description
    \begin{minipage}[t]{0.9\textwidth}
        \begin{tikzpicture}[baseline=-0.5ex]
            \node[
                fill=hdxpurple,
                text=white,
                font=\bfseries\Large,
                minimum size=2em,
                inner sep=3pt
            ] {#1};
        \end{tikzpicture}%
        \hspace{3mm}%
        {\color{hdxpurple}\bfseries\large #2}\\[2mm]
        {\small #3}
    \end{minipage}
    \vspace{5mm}
}

%% ============================================================================
%% NAVIGATION SYMBOLS
%% ============================================================================

% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}

\mode<all>
